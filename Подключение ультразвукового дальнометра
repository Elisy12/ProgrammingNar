HC-SR04 – ультразвуковой датчик расстояния. Характеристики:

-Питание: 5V
-Рабочий ток: 15 мА
-Звуковая частота: 40 кГц
-Угол измерения: 15 градусов
-Диапазон измерения: 2 см.. 4 м
-Точность: ~1 мм при грамотной фильтрации

Датчик работает довольно интересно: подаём импульс с продолжительностью 10 мкс на пин Trig, модуль посылает ультразвуковой импульс, он отражается от препятствия и детектируется.
Затем с пина Echo возвращается импульс по продолжительности соответствующий времени путешествия звуковой волны.
Ардуина этот импульс должна измерить.

С датчиком можно работать без библиотек, стандартными средствами Arduino. Но есть и библиотеки:
-HC-SR04 – можно установить по названию HC-SR04 из менеджера библиотек (автор Dirk Sarodnick)
-NewPing – можно установить по названию NewPing из менеджера библиотек

Небольшой момент: чтобы датчик не ловил “эхо” от самого себя – его не рекомендуется опрашивать чаще 30 мс!

Кстати, опрос датчика при помощи pulseIn(), не так плох, как про него пишут на форумах: погрешность измерения составляет всего 0.5 мкс:
что в пересчёте на расстояние даёт точность 0.17 мм! На деле точность получается в два раза выше, так как фактически мы измеряем сигнал два раза (путь до препятствия и обратно).
Сам датчик шумит гораздо сильнее, поэтому миллиметровую точность получить абсолютно не проблема. Но есть проблема в другом: выполнение кода блокируется на время измерения, например на трёх метрах это будет 17 мс.
Вроде и немного, но для некоторых задач это будет весьма критично.

В диапазоне -50.. 50°С зависимость является линейной и аппроксимируется уравнением V = 0.609 * t + 330.75:
Таким образом для нахождения более точного расстояния с поправкой на температуру достаточно делить время импульса не на 58, а на.. кстати, откуда берётся 58?
Для прохождения 1 м звуку понадобится 1 / 343 = 0.0029 с, или 2.915 мс. Мы получаем время туда и обратно, поэтому умножаем ещё на 2. В и для сантиметров – ещё на 10, и получаем 58.3.
Гораздо понятнее было бы умножать время импульса на скорость звука и делить пополам.
